<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/admin/CreateEventModal.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/admin/CreateEventModal.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { useEffect, useState } from "react";
import { X } from "lucide-react";
import { motion } from "framer-motion";
import { toast } from "react-toastify";
import { addDoc, collection, doc, updateDoc } from "firebase/firestore";
import { db } from "../../firebase/firebaseConfig";
import "../ui/DataModal.css";

/**
 * Componente CreateEventModal
 *
 * Modal para crear y editar eventos.
 * Funciona para:
 * - Crear evento (cuando event es null)
 * - Editar evento (cuando event no es null)
 *
 * @component
 *
 * @param {Object} props - Propiedades del componente
 * @param {Function} props.onClose - Cierra la modal
 * @param {Function} props.onSaved - Ejecutada al guardar correctamente
 * @param {Event|null} props.event - Evento a editar (null si se crea uno nuevo)
 * @param {Event[]} props.existingEvents - Eventos existentes para enlazar
 *
 * @returns {JSX.Element} Modal de creación / edición de eventos
 */
export const CreateEventModal = ({
    onClose,
    onSaved,
    event,
    existingEvents,
}) => {
    /**
     * Estado del formulario
     */
    const [id, setId] = useState("");
    const [title, setTitle] = useState("");
    const [text, setText] = useState("");

    /**
     * Opciones del evento
     * @type {[EventOption[], Function]}
     */
    const [options, setOptions] = useState([]);

    /**
     * Mensaje de error mostrado al usuario
     * @type {[string, Function]}
     */
    const [error, setError] = useState("");

    /**
     * Estadísticas disponibles para requisitos
     * Se usa para construir el &lt;select>
     */
    const statOptions = [
        "vitality",
        "attack",
        "defense",
        "intelligence",
        "dexterity",
        "perception",
    ];

    /**
     * Modifica un campo de una opción del evento
     * (text o nextEventId)
     *
     * @param {number} index - Índice de la opción a modificar
     * @param {"text"|"nextEventId"} field - Campo a actualizar
     * @param {string} value - Nuevo valor
     */
    const handleOptionChange = (index, field, value) => {
        const updated = [...options];
        updated[index][field] = value;
        setOptions(updated);
    };

    /**
     * Modifica un requisito de una opción del evento
     * (stat o minValue)
     *
     * Crea el objeto 'requirements' si no existe y convierte
     * minValue a número.
     *
     * @param {number} index - Índice de la opción
     * @param {"stat"|"minValue"} field - Campo del requisito
     * @param {string|number} value - Nuevo valor
     */
    const handleRequirementChange = (index, field, value) => {
        const updated = [...options];
        if (!updated[index].requirements) updated[index].requirements = {};
        updated[index].requirements[field] =
            field === "minValue" ? Number(value) : value;
        setOptions(updated);
    };

    /**
     * Añade una nueva opción vacía al evento
     */
    const addOption = () => {
        setOptions([
            ...options,
            { text: "", nextEventId: "", requirements: {} },
        ]);
    };

    /**
     * Elimina una opción del evento por índice
     *
     * @param {number} index - Índice de la opción a eliminar
     */
    const removeOption = (index) => {
        const updated = [...options];
        updated.splice(index, 1);
        setOptions(updated);
    };

    /**
     * Se ejecuta al abrir el modal o cambiar el evento a editar
     */
    useEffect(() => {
        if (event) {
            setId(event.id || "");
            setTitle(event.title || "");
            setText(event.text || "");
            setOptions(event.options || []);
        } else {
            setId("");
            setTitle("");
            setText("");
            setOptions([]);
        }
    }, [event]);

    /**
     * Maneja el envío del formulario
     * Valida campos obligatorios y guarda el evento en Firestore
     *
     * @async
     * @param {React.FormEvent&lt;HTMLFormElement>} e - Evento de submit
     */
    const handleSubmit = async (e) => {
        e.preventDefault();
        setError("");

        if (!id.trim() || !title.trim() || !text.trim()) {
            setError("ID, título y texto son obligatorios");
            return;
        }

        const payload = { id, title, text, options };

        try {
            if (event &amp;&amp; event.docId) {
                await updateDoc(doc(db, "events", event.docId), payload);

                toast.success("Evento editado", {
                    theme: "dark",
                });
            } else {
                await addDoc(collection(db, "events"), payload);

                toast.success("Evento creado", {
                    theme: "dark",
                });
            }
            onSaved();
        } catch (err) {
            console.error(err);
            setError("Error al guardar el evento");
        }
    };

    return (
        &lt;motion.div
            className="modal-overlay"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
        >
            &lt;motion.div
                className="modal-content"
                initial={{ scale: 0.9, opacity: 0, y: 60 }}
                animate={{ scale: 1, opacity: 1, y: 0 }}
                exit={{ scale: 0.9, opacity: 0, y: 60 }}
                transition={{ duration: 0.3, ease: "easeOut" }}
            >
                &lt;button className="modal-close" onClick={onClose}>
                    &lt;X size={18} />
                &lt;/button>

                &lt;h2>{event ? "Editar evento" : "Crear evento"}&lt;/h2>

                {error &amp;&amp; &lt;p className="error">{error}&lt;/p>}

                &lt;form className="modal-form" onSubmit={handleSubmit}>
                    &lt;input
                        placeholder="ID del evento (ej: start_forest)"
                        value={id}
                        onChange={(e) => setId(e.target.value)}
                    />
                    &lt;input
                        placeholder="Título del evento"
                        value={title}
                        onChange={(e) => setTitle(e.target.value)}
                    />
                    &lt;textarea
                        placeholder="Texto del evento"
                        value={text}
                        onChange={(e) => setText(e.target.value)}
                        rows={4}
                    />

                    &lt;h3>Opciones&lt;/h3>
                    {options.map((opt, index) => (
                        &lt;div key={index} className="option-block">
                            &lt;input
                                placeholder="Texto de la opción"
                                value={opt.text}
                                onChange={(e) =>
                                    handleOptionChange(
                                        index,
                                        "text",
                                        e.target.value
                                    )
                                }
                            />
                            &lt;select
                                value={opt.nextEventId}
                                onChange={(e) =>
                                    handleOptionChange(
                                        index,
                                        "nextEventId",
                                        e.target.value
                                    )
                                }
                            >
                                &lt;option value="">-- Evento siguiente --&lt;/option>
                                {existingEvents.map((ev) => (
                                    &lt;option key={ev.docId} value={ev.id}>
                                        {ev.title || ev.id}
                                    &lt;/option>
                                ))}
                            &lt;/select>

                            &lt;select
                                value={opt.requirements?.stat || ""}
                                onChange={(e) =>
                                    handleRequirementChange(
                                        index,
                                        "stat",
                                        e.target.value
                                    )
                                }
                            >
                                &lt;option value="">
                                    -- Estadística requerida --
                                &lt;/option>
                                {statOptions.map((stat) => (
                                    &lt;option key={stat} value={stat}>
                                        {stat}
                                    &lt;/option>
                                ))}
                            &lt;/select>

                            &lt;input
                                type="number"
                                min="0"
                                placeholder="Valor mínimo"
                                value={opt.requirements?.minValue || ""}
                                onChange={(e) =>
                                    handleRequirementChange(
                                        index,
                                        "minValue",
                                        e.target.value
                                    )
                                }
                            />

                            &lt;button
                                type="button"
                                onClick={() => removeOption(index)}
                                className="remove-option-btn"
                            >
                                Eliminar opción
                            &lt;/button>
                        &lt;/div>
                    ))}

                    &lt;button
                        type="button"
                        className="add-option-btn"
                        onClick={addOption}
                    >
                        Agregar opción
                    &lt;/button>

                    &lt;button type="submit" className="modal-btn">
                        Guardar evento
                    &lt;/button>
                &lt;/form>
            &lt;/motion.div>
        &lt;/motion.div>
    );
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#AdminClasses">AdminClasses</a></li><li><a href="global.html#AdminDashboard">AdminDashboard</a></li><li><a href="global.html#AdminEvents">AdminEvents</a></li><li><a href="global.html#AdminLayout">AdminLayout</a></li><li><a href="global.html#AdminSidebar">AdminSidebar</a></li><li><a href="global.html#AdminUsers">AdminUsers</a></li><li><a href="global.html#AppRoutes">AppRoutes</a></li><li><a href="global.html#AuthContext">AuthContext</a></li><li><a href="global.html#AuthProvider">AuthProvider</a></li><li><a href="global.html#BentoCard">BentoCard</a></li><li><a href="global.html#CTA">CTA</a></li><li><a href="global.html#CharacterCard">CharacterCard</a></li><li><a href="global.html#ClassCard">ClassCard</a></li><li><a href="global.html#CreateCharacterModal">CreateCharacterModal</a></li><li><a href="global.html#CreateClassModal">CreateClassModal</a></li><li><a href="global.html#CreateEventModal">CreateEventModal</a></li><li><a href="global.html#CreateUserModal">CreateUserModal</a></li><li><a href="global.html#DeleteModal">DeleteModal</a></li><li><a href="global.html#Demo">Demo</a></li><li><a href="global.html#EventCard">EventCard</a></li><li><a href="global.html#FeatureCard">FeatureCard</a></li><li><a href="global.html#Features">Features</a></li><li><a href="global.html#Header">Header</a></li><li><a href="global.html#Hero">Hero</a></li><li><a href="global.html#Landing">Landing</a></li><li><a href="global.html#Loader">Loader</a></li><li><a href="global.html#Login">Login</a></li><li><a href="global.html#Play">Play</a></li><li><a href="global.html#ProtectedRoute">ProtectedRoute</a></li><li><a href="global.html#Register">Register</a></li><li><a href="global.html#UserCard">UserCard</a></li><li><a href="global.html#UserCharacters">UserCharacters</a></li><li><a href="global.html#UserDashboard">UserDashboard</a></li><li><a href="global.html#UserLayout">UserLayout</a></li><li><a href="global.html#UserSidebar">UserSidebar</a></li><li><a href="global.html#adminApp">adminApp</a></li><li><a href="global.html#adminAuth">adminAuth</a></li><li><a href="global.html#app">app</a></li><li><a href="global.html#auth">auth</a></li><li><a href="global.html#db">db</a></li><li><a href="global.html#firebaseConfig">firebaseConfig</a></li><li><a href="global.html#handleLogout">handleLogout</a></li><li><a href="global.html#handleStatChange">handleStatChange</a></li><li><a href="global.html#handleSubmit">handleSubmit</a></li><li><a href="global.html#useAuth">useAuth</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Tue Jan 13 2026 12:01:34 GMT+0100 (hora estándar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
